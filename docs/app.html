<!DOCTYPE html>  <html> <head>   <title>app.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               app.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Author: Takeharu.Oshida<br>
repository: https://github.com/georgeOsdDev/chrome-app-storage-sample<br>
Licence: MIT<br></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><strong>Namespace of App</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">App</span> <span class="o">=</span><span class="p">{</span>
  <span class="nx">sessionKey</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
  <span class="nx">objNo</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
  <span class="nx">objList</span><span class="o">:</span><span class="p">{},</span>
  <span class="nx">draggableOption</span><span class="o">:</span><span class="p">{</span>
    <span class="nx">scroll</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
    <span class="nx">opacity</span><span class="o">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">ui</span><span class="p">){</span>
      <span class="nx">startMoving</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">ui</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">stop</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">ui</span><span class="p">){</span>
      <span class="nx">stopMoving</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">ui</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p><strong><code>onChange</code> eventListener</strong>
when data was updated by other device,
Refresh Application</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">chrome</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">onChanged</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">changes</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;storage updated&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">changes</span><span class="p">[</span><span class="s2">&quot;lastUpdUser&quot;</span><span class="p">]</span> 
      <span class="o">&amp;&amp;</span> <span class="nx">changes</span><span class="p">[</span><span class="s2">&quot;lastUpdUser&quot;</span><span class="p">].</span><span class="nx">newValue</span><span class="p">.</span><span class="nx">sessionKey</span> <span class="o">!=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">sessionKey</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>console.log("by another device");</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">refreshApp</span><span class="p">(</span><span class="nx">changes</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>console.log("by myself");</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Dom ready</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Bind <code>createObj</code> function to buttons
create object based on <code>data</code> attribute.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#menu &gt; a&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span><span class="nx">domEle</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">that</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">dataJson</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">that</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">));</span>
      <span class="nx">createObj</span><span class="p">(</span><span class="nx">dataJson</span><span class="p">,</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>bind <code>clearAll</code> function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#clearBtn&quot;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">clearAll</span><span class="p">();</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>initialize Application.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">initialize</span><span class="p">();</span>

<span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><strong>Create Object</strong>
@param obj
@param isInitialize</p>

<p>Create DOM object.
If it was triggerd by initailization phase, We don't save the new object to storage.
Only it was triggerd by user, We save the new data to storage.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">createObj</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="nx">isInitialize</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="p">)){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;!!!&quot;</span> <span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">conts</span> <span class="o">=</span><span class="s2">&quot;&quot;</span>
      <span class="p">,</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
      <span class="p">,</span><span class="nx">styleClass</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">styleClass</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span>
      <span class="p">,</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">color</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>if it is not Initialization phase,
get unique id.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isInitialize</span><span class="p">){</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;obj&#39;</span><span class="o">+</span><span class="nx">App</span><span class="p">.</span><span class="nx">objNo</span><span class="p">;</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="s2">&quot;Edit and Drag Me.&quot;</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">objNo</span> <span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">id</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>switch inner element by its styleClass</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">switch</span><span class="p">(</span><span class="nx">styleClass</span><span class="p">){</span>
    <span class="k">case</span> <span class="s2">&quot;postit&quot;</span><span class="o">:</span>
      <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
      <span class="nx">conts</span> <span class="o">=</span> <span class="s2">&quot;&lt;textarea class=&#39;post-&quot;</span><span class="o">+</span><span class="nx">color</span><span class="o">+</span><span class="s2">&quot;&#39; col=&#39;5&#39; row=&#39;10&#39;&gt;&quot;</span><span class="o">+</span><span class="nx">text</span><span class="o">+</span><span class="s2">&quot;&lt;/textarea&gt;&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;stamp&quot;</span><span class="o">:</span>
      <span class="nx">conts</span> <span class="o">=</span><span class="s2">&quot;&lt;p style=&#39;color:&quot;</span><span class="o">+</span><span class="nx">color</span><span class="o">+</span><span class="s2">&quot;&#39;&gt;&amp;&quot;</span><span class="o">+</span><span class="nx">obj</span><span class="p">.</span><span class="nx">stamp</span><span class="o">+</span><span class="s2">&quot;;&lt;/p&gt;&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Create DOM Element</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">elm</span> <span class="o">=</span> <span class="s2">&quot;&lt;div id=&#39;&quot;</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;&#39; class=&#39;&quot;</span><span class="o">+</span><span class="nx">styleClass</span><span class="o">+</span><span class="s2">&quot; btn-&quot;</span><span class="o">+</span> <span class="nx">color</span> <span class="o">+</span> <span class="s2">&quot; obj-init&#39;&gt;&quot;</span>
            <span class="o">+</span><span class="s2">&quot;&lt;button type=&#39;button&#39; class=&#39;close close-margin&#39; data-dismiss=&#39;alert&#39;&gt;&lt;i class=&#39;icon-remove&#39;&gt;&lt;/i&gt;&lt;/button&gt;&quot;</span>
            <span class="o">+</span><span class="nx">conts</span>
            <span class="o">+</span><span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#mainboardDiv&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">elm</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>watch inner text of postit</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;&gt; textarea&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;keyup&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;&gt; textarea&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="nx">editObj</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>bind jquery.UI's <code>draggable</code> and TwitterBootstrap's <code>closed</code> event</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">id</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">draggable</span><span class="p">(</span><span class="nx">App</span><span class="p">.</span><span class="nx">draggableOption</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;closed&quot;</span><span class="p">);</span>
    <span class="nx">removeObj</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>If it was initailized phase, apply position of object from storage</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">isInitialize</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="nx">obj</span><span class="p">.</span><span class="nx">top</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="nx">obj</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Else save on storage.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">obj</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">);</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">id</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">);</span>    
    <span class="nx">obj</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;&gt; textarea&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="nx">save</span><span class="p">();</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>And last, show element.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">id</span><span class="p">).</span><span class="nx">fadeIn</span><span class="p">();</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><strong>startMoving</strong>
@param event
@param ui
do nothing when it start moving</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">startMoving</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">ui</span><span class="p">){</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><strong>stopMoving</strong>
@param event
@param ui
save object position when it stop moving.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">stopMoving</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">ui</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">helper</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
  <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
  <span class="nx">save</span><span class="p">();</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><strong>removeObj</strong>
@param data
When object was <code>removed</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">removeObj</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;remove&quot;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>remove from DOM.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>remove from Memory.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>save change</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">save</span><span class="p">();</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><strong>editObj</strong>
@param data
When object was <code>edited</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">editObj</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>save change</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">save</span><span class="p">();</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p><strong>clearAll</strong>
Remove all objects</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">clearAll</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>from DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#mainboardDiv&quot;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>from Memory</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">App</span><span class="p">.</span><span class="nx">objNo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>save change</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">save</span><span class="p">();</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p><strong>Initialize</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">initialize</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;initialize&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>set sessionKey per device</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">App</span><span class="p">.</span><span class="nx">sessionKey</span><span class="p">)</span> <span class="nx">App</span><span class="p">.</span><span class="nx">sessionKey</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">platform</span><span class="o">+</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="p">(</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>get objects from Storage</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">chrome</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">){</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">objNo</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">objNo</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">objList</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">createObj</span><span class="p">(</span><span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p><strong>refreshApp</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">refreshApp</span><span class="p">(</span><span class="nx">changes</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">changes</span><span class="p">[</span><span class="s2">&quot;objList&quot;</span><span class="p">])</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">newObjList</span> <span class="o">=</span> <span class="nx">changes</span><span class="p">[</span><span class="s2">&quot;objList&quot;</span><span class="p">].</span><span class="nx">newValue</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">oldObjList</span> <span class="o">=</span> <span class="nx">changes</span><span class="p">[</span><span class="s2">&quot;objList&quot;</span><span class="p">].</span><span class="nx">oldValue</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key1</span> <span class="k">in</span> <span class="nx">newObjList</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">oldObjList</span><span class="p">[</span><span class="nx">key1</span><span class="p">]){</span>
      <span class="nx">createObj</span><span class="p">(</span><span class="nx">newObjList</span><span class="p">[</span><span class="nx">key1</span><span class="p">],</span><span class="kc">true</span><span class="p">);</span>      
    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key2</span> <span class="k">in</span> <span class="nx">newObjList</span><span class="p">[</span><span class="nx">key1</span><span class="p">]){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">newObjList</span><span class="p">[</span><span class="nx">key1</span><span class="p">][</span><span class="nx">key2</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">oldObjList</span><span class="p">[</span><span class="nx">key1</span><span class="p">][</span><span class="nx">key2</span><span class="p">]){</span>
          <span class="nx">createObj</span><span class="p">(</span><span class="nx">newObjList</span><span class="p">[</span><span class="nx">key1</span><span class="p">],</span><span class="kc">true</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>      
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">key3</span> <span class="k">in</span> <span class="nx">oldObjList</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">newObjList</span><span class="p">[</span><span class="nx">key3</span><span class="p">]){</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">key3</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>remove from Memory.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">[</span><span class="nx">key3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>  
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p><strong>save</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">function</span> <span class="nx">save</span><span class="p">(){</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>
    <span class="s2">&quot;objList&quot;</span><span class="o">:</span><span class="nx">App</span><span class="p">.</span><span class="nx">objList</span><span class="p">,</span>
    <span class="s2">&quot;objNo&quot;</span><span class="o">:</span><span class="nx">App</span><span class="p">.</span><span class="nx">objNo</span><span class="p">,</span>
    <span class="s2">&quot;lastUpdUser&quot;</span><span class="o">:</span><span class="p">{</span>
      <span class="s2">&quot;sessionKey&quot;</span><span class="o">:</span><span class="nx">App</span><span class="p">.</span><span class="nx">sessionKey</span><span class="p">,</span>
      <span class="s2">&quot;time&quot;</span><span class="o">:+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">},</span><span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>console.log("saved");</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">});</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 